name: Update Market Data on: schedule: - cron: '0 14 * * *' workflow_dispatch: jobs: update: runs-on: ubuntu-latest steps: - uses: actions/checkout@v3 - name: Set up Python uses: actions/setup-python@v4 with: python-version: '3.10' - name: Install dependencies run: | pip install yfinance ccxt requests pandas - name: Create update script run: | cat > update_data.py << 'EOF' import yfinance as yf import ccxt import requests import pandas as pd from datetime import datetime # Equities for symbol in ['SPY', 'QQQ', 'IWM', 'VTI']: df = yf.Ticker(symbol).history(period='1y') df.to_csv(f'data/equities/{symbol.lower()}.csv') # Options for symbol in ['SPY', 'QQQ']: ticker = yf.Ticker(symbol) if ticker.options: opts = ticker.option_chain(ticker.options[0]) pd.concat([opts.calls, opts.puts]).to_csv(f'data/options/{symbol.lower()}_options.csv', index=False) # Crypto exchange = ccxt.binance() for pair in ['BTC/USDT', 'ETH/USDT', 'BNB/USDT', 'SOL/USDT']: ohlcv = exchange.fetch_ohlcv(pair, '1d', limit=365) df = pd.DataFrame(ohlcv, columns=['timestamp', 'open', 'high', 'low', 'close', 'volume']) df['pair'] = pair df.to_csv(f'data/crypto/{pair.replace("/", "_").lower()}.csv', index=False) # CoinGecko r = requests.get('https://api.coingecko.com/api/v3/coins/markets', params={'vs_currency': 'usd', 'order': 'market_cap_desc', 'per_page': 100}) pd.DataFrame(r.json()).to_csv('data/crypto/coingecko_top_100.csv', index=False) EOF - name: Run update run: python update_data.py - name: Commit and push changes run: | git config user.email "action@github.com" git config user.name "GitHub Action" git add data/ git commit -m "Auto-update market data $(date)" || true git push
